# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥ æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

## ðŸ“… ä½œæˆæ—¥æ™‚
2025-12-14

## ðŸ” æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç¢ºèªçµæžœ

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
| é …ç›® | å€¤ | ç¢ºèªã‚½ãƒ¼ã‚¹ |
|------|-----|-----------|
| user_id | `00c7e152-bfae-4773-93b5-bab65e64faf2` | ã‚¢ãƒ—ãƒªãƒ­ã‚° |
| user_name | Momo | recent_pins RPCçµæžœ |
| user_avatar_url | `https://jkpenklhrlbctebkpvax.supabase.co/storage/v1/object/public/profile-avatars/00c7e152-bfae-4773-93b5-bab65e64faf2/avatar_1764564464093.jpg` | RPCçµæžœ |

### 2. æ—¢å­˜ãƒ«ãƒ¼ãƒˆæƒ…å ±
| route_id | route_name | area_name | distance_meters |
|----------|------------|-----------|-----------------|
| `6ae42d51-4221-4075-a2c7-cb8572e17cf7` | èŠ¦ãƒŽæ¹–ç•”ãƒ­ãƒ³ã‚°ã‚¦ã‚©ãƒ¼ã‚¯ | ç®±æ ¹ | 6800 |

### 3. æ—¢å­˜ã‚¹ãƒãƒƒãƒˆï¼ˆãƒ”ãƒ³ï¼‰æƒ…å ±
| spot_id (pin_id) | title | pin_type | èª¬æ˜Ž |
|------------------|-------|----------|------|
| `2491ff81-9003-4548-98c6-a35d5a2a574e` | èŠ¦ãƒŽæ¹–ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ | scenery | çµ¶æ™¯ã‚¹ãƒãƒƒãƒˆï¼æ„›çŠ¬ã‚‚å¤§å–œã³ |
| `e1345e3b-e6f5-4a10-b54f-699fcb9e66d9` | ãƒ©ãƒ³ãƒä¼‘æ†©ã‚¹ãƒãƒƒãƒˆ | other | ãƒ©ãƒ³ãƒã«æœ€é©ãªå ´æ‰€ |

### 4. route_pins ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
```sql
CREATE TABLE route_pins (
  id UUID PRIMARY KEY,
  route_id UUID REFERENCES official_routes NOT NULL,
  user_id UUID REFERENCES auth.users NOT NULL,
  dog_id UUID REFERENCES dogs,
  location GEOGRAPHY(Point, 4326) NOT NULL,
  pin_type TEXT CHECK (pin_type IN ('scenery', 'shop', 'encounter', 'other')) NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  likes_count INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

## âœ… æŠ•å…¥ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

### ãƒ¬ãƒ“ãƒ¥ãƒ¼1: èŠ¦ãƒŽæ¹–ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆé«˜è©•ä¾¡ï¼‰
```yaml
user_id: 00c7e152-bfae-4773-93b5-bab65e64faf2
spot_id: 2491ff81-9003-4548-98c6-a35d5a2a574e
rating: 5/5 â­â­â­â­â­
review_text: |
  çµ¶æ™¯ã‚¹ãƒãƒƒãƒˆï¼èŠ¦ãƒŽæ¹–ã®å…¨æ™¯ãŒä¸€æœ›ã§ãã€å¯Œå£«å±±ã‚‚è¦‹ãˆã¾ã—ãŸã€‚
  æ„›çŠ¬ã®ã±ã‚“ã¡ã‚‚ãƒ ãƒƒã‚¯ã‚‚å¤§èˆˆå¥®ã§ã—ãŸã€‚å†™çœŸæ˜ ãˆã™ã‚‹å ´æ‰€ãªã®ã§ã€
  ã‚«ãƒ¡ãƒ©ã¯å¿…é ˆã§ã™ã€‚é¢¨ãŒå¼·ã„æ—¥ã‚‚ã‚ã‚‹ã®ã§ã€ä¸Šç€ãŒã‚ã‚‹ã¨è‰¯ã„ã§ã™ã€‚

è¨­å‚™æƒ…å ±:
  - æ°´é£²ã¿å ´: âŒ
  - ãƒ‰ãƒƒã‚°ãƒ©ãƒ³: âŒ
  - æ—¥é™°: âœ… (æœ¨é™°)
  - ãƒˆã‚¤ãƒ¬: âŒ
  - é§è»Šå ´: âœ…
  - çŠ¬ç”¨ã‚´ãƒŸç®±: âœ…
  - ãƒªãƒ¼ãƒ‰å¿…é ˆ: âœ…
  - ã‚«ãƒ•ã‚§: âŒ
  - é©åˆçŠ¬ã‚µã‚¤ã‚º: allï¼ˆå…¨ã‚µã‚¤ã‚ºï¼‰
  
å­£ç¯€æƒ…å ±: æ˜¥ã¯æ¡œã€ç§‹ã¯ç´…è‘‰ãŒç¾Žã—ã„ã€‚å†¬ã¯é›ªæ™¯è‰²ã‚‚æ¥½ã—ã‚ã¾ã™ã€‚

å†™çœŸ: 3æžš
  - https://picsum.photos/seed/hakone1/800/600
  - https://picsum.photos/seed/hakone2/800/600
  - https://picsum.photos/seed/hakone3/800/600
```

### ãƒ¬ãƒ“ãƒ¥ãƒ¼2: ãƒ©ãƒ³ãƒä¼‘æ†©ã‚¹ãƒãƒƒãƒˆï¼ˆè‰¯ã„è©•ä¾¡ï¼‰
```yaml
user_id: 00c7e152-bfae-4773-93b5-bab65e64faf2
spot_id: e1345e3b-e6f5-4a10-b54f-699fcb9e66d9
rating: 4/5 â­â­â­â­
review_text: |
  ãƒ©ãƒ³ãƒä¼‘æ†©ã«æœ€é©ãªå ´æ‰€ã§ã™ã€‚ãƒ™ãƒ³ãƒã‚‚ã‚ã‚Šã€æ„›çŠ¬ã¨ä¸€ç·’ã«ã‚†ã£ãã‚Š
  é£Ÿäº‹ãŒã§ãã¾ã—ãŸã€‚æ°´é£²ã¿å ´ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€è¿‘ãã«ã‚³ãƒ³ãƒ“ãƒ‹ãŒã‚ã‚‹ã®ã§
  æ°´ã¯èª¿é”ã§ãã¾ã™ã€‚ãƒˆã‚¤ãƒ¬ã‚‚è¿‘ãã«ã‚ã£ã¦ä¾¿åˆ©ã§ã™ã€‚
  ãŸã ã—ã€æ—¥å·®ã—ãŒå¼·ã„æ—¥ã¯æ—¥é™°ãŒå°‘ãªã„ã®ã§ã€ãƒ‘ãƒ©ã‚½ãƒ«ãŒã‚ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

è¨­å‚™æƒ…å ±:
  - æ°´é£²ã¿å ´: âŒ
  - ãƒ‰ãƒƒã‚°ãƒ©ãƒ³: âŒ
  - æ—¥é™°: âŒ (å°‘ãªã„)
  - ãƒˆã‚¤ãƒ¬: âœ… (è¿‘ãã«ã‚ã‚Š)
  - é§è»Šå ´: âœ…
  - çŠ¬ç”¨ã‚´ãƒŸç®±: âœ…
  - ãƒªãƒ¼ãƒ‰å¿…é ˆ: âœ…
  - ã‚«ãƒ•ã‚§: âœ… (è¿‘ãã«çŠ¬åŒä¼´å¯èƒ½)
  - é©åˆçŠ¬ã‚µã‚¤ã‚º: mediumï¼ˆä¸­åž‹çŠ¬ã¾ã§ï¼‰
  
å­£ç¯€æƒ…å ±: å¤ã¯æš‘ã„ã®ã§æ—©æœã‹å¤•æ–¹ãŒãŠã™ã™ã‚ã€‚æ˜¥ç§‹ã¯å¿«é©ã§ã™ã€‚

å†™çœŸ: 2æžš
  - https://picsum.photos/seed/lunch1/800/600
  - https://picsum.photos/seed/lunch2/800/600
```

## ðŸ” ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

### å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„
| åˆ¶ç´„ | å‚ç…§å…ˆ | å€¤ | ç¢ºèªçµæžœ |
|------|--------|-----|----------|
| user_id â†’ auth.users(id) | auth.users | `00c7e152-bfae-4773-93b5-bab65e64faf2` | âœ… å­˜åœ¨ç¢ºèªæ¸ˆã¿ï¼ˆã‚¢ãƒ—ãƒªãƒ­ã‚°ã‚ˆã‚Šï¼‰ |
| spot_id â†’ route_pins(id) | route_pins | `2491ff81-9003-4548-98c6-a35d5a2a574e` | âœ… å­˜åœ¨ç¢ºèªæ¸ˆã¿ï¼ˆRPCãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚ˆã‚Šï¼‰ |
| spot_id â†’ route_pins(id) | route_pins | `e1345e3b-e6f5-4a10-b54f-699fcb9e66d9` | âœ… å­˜åœ¨ç¢ºèªæ¸ˆã¿ï¼ˆRPCãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚ˆã‚Šï¼‰ |

### UNIQUEåˆ¶ç´„
| åˆ¶ç´„ | èª¬æ˜Ž | å¯¾å¿œ |
|------|------|------|
| UNIQUE(user_id, spot_id) | 1ãƒ¦ãƒ¼ã‚¶ãƒ¼1ã‚¹ãƒãƒƒãƒˆ1ãƒ¬ãƒ“ãƒ¥ãƒ¼ | âœ… `ON CONFLICT ... DO UPDATE` ã§å¯¾å¿œ |

### CHECKåˆ¶ç´„
| åˆ¶ç´„ | å€¤ | ç¢ºèªçµæžœ |
|------|-----|----------|
| rating >= 1 AND rating <= 5 | 5, 4 | âœ… ç¯„å›²å†… |

## ðŸ“Š æŠ•å…¥å¾Œã®ç¢ºèªã‚¯ã‚¨ãƒª

### 1. æŠ•å…¥ã—ãŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ç¢ºèª
```sql
SELECT 
  sr.id,
  sr.rating,
  LEFT(sr.review_text, 50) as review_preview,
  sr.has_water_fountain,
  sr.has_dog_run,
  sr.has_shade,
  sr.has_toilet,
  sr.has_parking,
  sr.dog_size_suitable,
  sr.created_at
FROM spot_reviews sr
WHERE sr.user_id = '00c7e152-bfae-4773-93b5-bab65e64faf2'::UUID
ORDER BY sr.created_at DESC;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ:** 2ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### 2. ã‚¹ãƒãƒƒãƒˆåˆ¥ã®çµ±è¨ˆ
```sql
SELECT 
  spot_id,
  COUNT(*) as review_count,
  ROUND(AVG(rating)::numeric, 2) as average_rating,
  MAX(rating) as max_rating,
  MIN(rating) as min_rating
FROM spot_reviews
GROUP BY spot_id
ORDER BY average_rating DESC;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ:**
- `2491ff81-...` (èŠ¦ãƒŽæ¹–ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ): å¹³å‡5.0ã€1ä»¶
- `e1345e3b-...` (ãƒ©ãƒ³ãƒä¼‘æ†©ã‚¹ãƒãƒƒãƒˆ): å¹³å‡4.0ã€1ä»¶

### 3. è¨­å‚™åˆ¥ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¤œç´¢
```sql
-- é§è»Šå ´ãŒã‚ã‚‹ã‚¹ãƒãƒƒãƒˆ
SELECT spot_id, rating, review_text
FROM spot_reviews
WHERE has_parking = true
ORDER BY rating DESC;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ:** 2ä»¶ï¼ˆä¸¡æ–¹ã¨ã‚‚é§è»Šå ´ã‚ã‚Šï¼‰

```sql
-- æ—¥é™°ãŒã‚ã‚‹ã‚¹ãƒãƒƒãƒˆ
SELECT spot_id, rating, review_text
FROM spot_reviews
WHERE has_shade = true
ORDER BY rating DESC;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ:** 1ä»¶ï¼ˆèŠ¦ãƒŽæ¹–ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆã®ã¿ï¼‰

## âœ… æœ€çµ‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ç¢ºèª
- [x] æ—¢å­˜ã‚¹ãƒãƒƒãƒˆIDã®ç¢ºèª
- [x] route_pinsãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®ç¢ºèª
- [x] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®å¦¥å½“æ€§ç¢ºèª
- [x] UNIQUEåˆ¶ç´„ã®å¯¾å¿œï¼ˆON CONFLICTï¼‰
- [x] CHECKåˆ¶ç´„ã®å€¤ç¯„å›²ç¢ºèª
- [x] TEXT[]é…åˆ—åž‹ã®ä½¿ç”¨ç¢ºèª
- [x] å†™çœŸURLã®å½¢å¼ç¢ºèª
- [x] å†å®Ÿè¡Œå¯èƒ½æ€§ã®ä¿è¨¼ï¼ˆå†ªç­‰æ€§ï¼‰

## ðŸŽ¯ å®Ÿè¡Œæº–å‚™å®Œäº†

**ãƒ•ã‚¡ã‚¤ãƒ«:** `20251214_insert_test_reviews.sql`  
**æŽ¨å¥¨å®Ÿè¡Œç’°å¢ƒ:** Supabase SQL Editor  
**å®Ÿè¡Œæ–¹æ³•:** SQLã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ã€ŒRunã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

---

**ä½œæˆè€…:** ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§è‡ªå‹•æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ   
**æœ€çµ‚ç¢ºèª:** 2025-12-14
