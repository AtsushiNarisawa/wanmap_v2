# 芦ノ湖畔ロングウォークを今月の人気1位にする手順

## 📋 概要

このスクリプトは、「芦ノ湖畔ロングウォーク」に30回の散歩データを追加して、今月の人気ルートランキングで1位にします。

## 🎯 実行対象

- **ルート名**: 芦ノ湖畔ロングウォーク
- **route_id**: `6ae42d51-4221-4075-a2c7-cb8572e17cf7`
- **追加データ**: 30回の散歩記録（過去1ヶ月間に分散）

## 📝 実行手順

### 1. Supabase SQL Editorを開く

1. [Supabase Dashboard](https://supabase.com/dashboard)にログイン
2. プロジェクト選択: **wanmap_v2**
3. 左メニューから「SQL Editor」を選択

### 2. SQLスクリプトを実行

1. 「New query」をクリック
2. `scripts/make_ashinoko_route_top1.sql`の内容をコピー＆ペースト
3. 「Run」ボタンをクリック

### 3. 実行結果の確認

実行が成功すると、以下の3つの結果が表示されます：

#### ① 通知メッセージ
```
NOTICE: 芦ノ湖畔ロングウォークに30回の散歩データを追加しました
```

#### ② 今月の人気ルートランキング
```
route_name                  | area_name | monthly_walks | distance_km | estimated_minutes
----------------------------|-----------|---------------|-------------|------------------
芦ノ湖畔ロングウォーク      | 箱根      | 30            | 5.2         | 75
[他のルート...]             | ...       | <30           | ...         | ...
```

#### ③ 芦ノ湖畔ロングウォークの詳細
```
route_name                  | total_walks | monthly_walks | first_walk          | last_walk
----------------------------|-------------|---------------|---------------------|---------------------
芦ノ湖畔ロングウォーク      | 30          | 30            | 2024-11-10 08:00:00 | 2024-12-10 19:00:00
```

#### ④ 完了メッセージ
```
status
--------------------------------------------------------------
✅ 芦ノ湖畔ロングウォークを今月の人気1位にしました（30回の散歩データ追加）
```

## 🔍 アプリでの確認方法

### Flutter アプリ
1. アプリを起動
2. **ホーム画面**にアクセス
3. 「人気急上昇ルート」セクションを確認
4. 「芦ノ湖畔ロングウォーク」が**1位**に表示されることを確認

### 確認ポイント
- ✅ ルート名: 芦ノ湖畔ロングウォーク
- ✅ 位置: 1位（最上位）
- ✅ 散歩回数: 30回
- ✅ バッジ: オレンジ色の「人気急上昇」バッジ

## 📊 追加されるデータの詳細

### 散歩データの分散
- **期間**: 過去30日間
- **時間帯**: 8時～19時の間で分散
- **time_slot**: morning, midday, evening
- **season**: 現在の季節（winter）

### データ例
```sql
walked_at: 2024-12-10 10:00:00  -- 今日の午前
walked_at: 2024-12-09 11:00:00  -- 昨日の午前
walked_at: 2024-12-08 13:00:00  -- 2日前の昼
...
walked_at: 2024-11-11 19:00:00  -- 29日前の夕方
```

## ⚠️ 注意事項

### 実行前の確認
1. **ユーザーと犬のデータが存在すること**
   - `auth.users`テーブルにユーザーが登録されている
   - `dogs`テーブルに犬が登録されている

2. **芦ノ湖畔ロングウォークが存在すること**
   - route_id: `6ae42d51-4221-4075-a2c7-cb8572e17cf7`

### 重複実行について
- このスクリプトは**複数回実行可能**です
- 実行するたびに30回ずつ追加されます
- 例: 2回実行 → 60回、3回実行 → 90回

### データのリセット
もしデータをリセットしたい場合：
```sql
-- 芦ノ湖畔ロングウォークの散歩データを削除
DELETE FROM route_walks 
WHERE route_id = '6ae42d51-4221-4075-a2c7-cb8572e17cf7';
```

## 🔄 他のルートを1位にする方法

`make_ashinoko_route_top1.sql`をコピーして、`v_route_id`を変更するだけです：

```sql
-- 例: 別のルートを1位にする
DECLARE
  v_route_id UUID := '別のroute_id'; -- ここを変更
  ...
```

## 📞 トラブルシューティング

### エラー: "ユーザー、犬、またはルートが見つかりません"

**原因**: 必要なデータが存在しない

**解決方法**:
```sql
-- ユーザーの確認
SELECT id, email FROM auth.users LIMIT 5;

-- 犬の確認
SELECT id, name, user_id FROM dogs LIMIT 5;

-- ルートの確認
SELECT id, name FROM official_routes 
WHERE id = '6ae42d51-4221-4075-a2c7-cb8572e17cf7';
```

### エラー: "relation route_walks does not exist"

**原因**: `route_walks`テーブルが存在しない

**解決方法**: テーブル作成スクリプトを先に実行してください

## 📚 関連ファイル

- `create_monthly_popular_routes_rpc_fixed.sql` - RPC関数定義
- `insert_dummy_route_walks_final.sql` - 他のルートのダミーデータ
- `insert_ashinoko_lakeside_route.sql` - 芦ノ湖畔ロングウォーク作成スクリプト

## 🎉 完了

このスクリプト実行後、アプリのホーム画面で「芦ノ湖畔ロングウォーク」が堂々の1位に表示されます！
